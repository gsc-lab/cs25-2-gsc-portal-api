#name: Deploy Backend
#
#permissions:
#  contents: read
#  packages: write
#
#on:
#  push:
#    branches: ["infra"]
#  release:
#    types: ["published"]
#
#jobs:
#  build-push-and-deploy:
#    runs-on: ubuntu-latest
#
#    env:
#      IMAGE_NAME: gsc-portal-backend
#      DOCKERHUB_USERNAME: sgwar
#
#    steps:
#      - name: Checkout code
#        uses: actions/checkout@v4
#
#      - name: Set up Docker Buildx
#        uses: docker/setup-buildx-action@v3
#
#      - name: Login to DockerHub
#        uses: docker/login-action@v3
#        with:
#          username: ${{ secrets.DOCKERHUB_USERNAME }}
#          password: ${{ secrets.DOCKERHUB_TOKEN }}
#
#      - name: Extract Git metadata
#        id: vars
#        run: |
#          echo "BRANCH=${GITHUB_REF##*/}" >> $GITHUB_ENV
#          echo "SHORT_SHA=$(git rev-parse --short HEAD)" >> $GITHUB_ENV
#
#      - name: Build and push Docker image
#        uses: docker/build-push-action@v5
#        with:
#          context: .
#          push: true
#          platforms: linux/amd64,linux/arm64
#          tags: |
#            sgwar/gsc-portal-backend:latest
#            sgwar/gsc-portal-backend:${{ env.BRANCH }}-${{ env.SHORT_SHA }}
#          cache-from: type=registry,ref=sgwar/gsc-portal-backend:buildcache
#          cache-to: type=registry,ref=sgwar/gsc-portal-backend:buildcache,mode=max
#
#      - name: Image deployed
#        run: |
#          echo "ðŸš€ Docker image pushed to Docker Hub!"
#          echo "ðŸ“¦ Image: sgwar/gsc-portal-backend:${{ env.BRANCH }}-${{ env.SHORT_SHA }}"
#
#      - name: Deploy to EC2
#        uses: appleboy/ssh-action@v1.0.3
#        with:
#          host: ${{ secrets.EC2_HOST }}
#          username: ${{ secrets.EC2_USER }}
#          key: ${{ secrets.EC2_KEY }}
#          script: |
#            echo "ðŸš€ Starting Backend deployment on EC2..."
#
#            cd ~/gsc-portal-infra
#
#            sudo ./deploy.sh backend
#            echo "âœ… Backend deployment completed!"