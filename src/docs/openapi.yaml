openapi: 3.0.0
info:
  title: GSC Portal API
  version: 1.0.0

tags:
  - name: Auth
  - name: Dashboard
  - name: Notices
  - name: Timetable
    description: 휴‧보강 이벤트 관리 API
  - name: Classroom
  - name: Files
  - name: Cleaning
  - name: Admin
  - name: Dispatch

paths:
  # === AUTH SECTION ===

  /auth:
    get:
      tags: [Auth]
      summary: Google OAuth 인증 URL 요청
      description: 사용자가 로그인 버튼 클릭 시, Google OAuth 인증을 위한 URL을 반환합니다.
      responses:
        "302":
          description: 성공적으로 Google 인증 페이지로 리다이렉트됩니다.
          content:
            application/json:
              schema:
                type: object
                properties:
                  url:
                    type: string
                    example: https://accounts.google.com/o/oauth2/v2/auth?...client_id=...


  /auth/callback:
    get:
      tags: [Auth]
      summary: Google OAuth 인증 완료 후 콜백 처리
      description: | 
        Google 인증 성공 후, 백엔드가 이 엔드포인트에서 사용자를 처리합니다.
        이 API는 JSON을 반환하지 않고, 시나리오에 따라 다른 페이지로 리다이렉트 시킵니다.
        성공시 **accessToken**과 **refreshToken**이 **httpOnly** 쿠키로 설정됩니다.
        **시나리오별 리다이렉트 규칙:**
        - **기존 사용자 로그인 성공:** `/dashboard` (프론트엔드 대시보드 페이지)
        - **신규 사용자:** `/register` (프론트엔드 회원가입 페이지)
        - **로그인 실패:** `/login?error={errorCode}` (프론트엔드 로그인 페이지)
      parameters:
        - name: code
          in: query
          required: true
          schema: { type: string }
          description: Google에서 전달하는 인증 코드
      responses:
        "302":
          description: |
            시나리오에 따라 다른 URL로 리다이렉트됩니다.
            - **성공:** `Location: {FRONTEND_URL}/dashboard`
            - **신규:** `Location: {FRONTEND_URL}/register`
            - **실패:** `Location: {FRONTEND_URL}/login?error=invalid_email`
    
            **실패 시 `errorCode` 종류:**
            - `invalid_email`: 허용되지 않은 이메일 도메인
            - `account_pending`: 관리자 승인 대기 중인 계정
            - `account_disabled`: 비활성화된 계정
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "403":
          description: 로그인 실패 (승인 대기 또는 거부된 사용자)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/register:
    post:
      tags:
        - Auth
      summary: 최초 로그인 사용자 정보 등록 (회원가입)
      description: |
        - Google OAuth 콜백 후 /register 페이지로 이동된 신규 사용자가 추가 정보를 제출하여 가입을 완료합니다.
        - 이 요청은 Google 로그인 후 백엔드가 설정한 세션을 기반으로 인증됩니다.
        - 요청 성공 시 해당 사용자의 status는 'pending'(승인 대기)으로 변경됩니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/UserRegistrationRequest"
      responses:
        "201":
          description: 등록 성공. "관리자 승인 후 로그인이 가능합니다."
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/User"
        "400":
          description: "잘못된 요청 (예: 필수 필드 누락, 유효하지 않은 형식)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "409":
          description: 이미 등록된 학번 또는 이메일 (Conflict)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/refresh:
    post:
      tags: [Auth]
      summary: Access Token 재발급
      description: |
        httpOnly 쿠키에 저장된 refreshToken을 사용하여 만료된 accessToken을 재발급합니다.
        Request Body는 비어있어야 합니다. 서버는 요청에 담긴 쿠키를 자동으로 읽어 처리합니다.
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                refresh_token:
                  type: string
                  example: 1//0gNabcABCDeFgHIJKLmnopQR_StUvWxYz
      responses:
        "200":
          description: 토큰 재발급 성공. 새로운 accessToken이 쿠키로 설정됩니다.
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/AuthResponse"
        "401":
          description: 유효하지 않거나 만료된 refresh token
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /auth/logout:
    post:
      tags:
        - Auth
      summary: 로그아웃
      description: |
        서버에 저장된 현재 기기의 Refresh Token을 무효화하고, 클라이언트의 accessToken 및 refreshToken 쿠키를 삭제합니다.
      responses:
        "200":
          description: 성공적으로 로그아웃되었습니다.
          content:
            application/json:
              schema:
                type: object
                properties:
                  success:
                    type: boolean
                    example: true
                  message:
                    type: string
                    example: 성공적으로 로그아웃되었습니다.

  /auth/me:
    get:
      tags: [Auth]
      summary: 현재 로그인된 사용자 정보
      description: >
        JWT를 통해 로그인된 사용자의 정보를 반환합니다.
        사용자 역할(`role_type`)에 따라 반환 필드가 달라집니다.  
        - **학생(student)**: 학년, 언어, 유학생 여부 포함  
        - **교수/관리자(professor/admin)**: 학년, 언어, 유학생 여부 미포함
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 사용자 정보 반환
          content:
            application/json:
              schema:
                type: object
                title: StudentUser
                properties:
                  user_id:
                    type: string
                    example: "2423006"
                  name:
                    type: string
                    example: "김김김"
                  email:
                    type: string
                    example: "이메일@g.yju.ac.kr"
                  phone:
                    type: string
                    example: "010-1234-5678"
                  role_type:
                    type: string
                    example: "student"
                  grade_id:
                    type: string
                    example: "1"
                  language_id:
                    type: string
                    example: "KR"
                  is_international:
                    type: string
                    example: "international"

        "401":
          description: 인증 실패
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: 접근 권한 없음
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "접근 권한이 없습니다."
        "404":
          description: 사용자 정보를 찾을 수 없음
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "사용자 정보를 찾을 수 없습니다."
    post:
      tags: [Auth]
      summary: 학생의 시험 성적 점수 업로드
      description: >
        - JLPT 또는 TOPIK 시험 성적 정보를 저장합니다.
        - 점수, 레벨 등 기본 정봉와 함께 성적표 파일을 업로드할 수 있습니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                exam_type:
                  type: string
                  example: "JLPT || TOPIK"
                score:
                  type: integer
                  example: 100
                level:
                  type: string
                  example: "N1"
                files:
                  type: string
                  format: binary
                  description: "성적표 파일 (PDF 등)"
      responses:
        "200":
          description: 성공적으로 저장 완료
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "성공적으로 완료되었습니다."

  # === DASHBOARD SECTION ===

  /dashboard:
    get:
      tags: [Dashboard]
      summary: 메인 대시보드 데이터 조회
      description: |
        - 로그인한 사용자의 메인 화면에 필요한 모든 데이터를 조회합니다.
        - 사용자의 역할(학생, 교수, 관리자)에 따라 반환되는 데이터가 달라집니다.
      security:
        - bearerAuth: []
      responses:
        "200":
          description: 대시보드 데이터 반환 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/DashboardResponse"

  # === NOTICES SECTION ===

  /notices:
    get:
      tags: [Notices]
      summary: 공지사항 목록 조회
      description: |
        - 학생: 자신에게 타겟된 공지 및 전체 공지
        - 교수/관리자: 모든 공지
      security:
        - bearerAuth: []
      parameters:
        - name: page
          in: query
          required: false
          schema:
            type: integer
            example: 1
          description: "조회할 페이지 번호 (기본값: 1)"
        - name: size
          in: query
          required: false
          schema:
            type: integer
            example: 10
          description: "한 페이지에 보여줄 공지 수 (기본값: 10)"
        - name: search
          in: query
          required: false
          schema:
            type: string
            example: "1학년"
          description: "조회할 게시물 제목"
        - name: course_id
          in: query
          required: false
          schema:
            type: string
            example: "C001"
          description: "특정 과목 ID로 필터링합니다. (모달 API를 통해 얻은 ID)"
        - name: course_type
          in: query
          required: false
          schema:
            type: string
            example: regular
          description: "과목 타입을 필터링합니다. (값: general, regular, special, korean)"
        - name: grade_id
          in: query
          required: false
          schema:
            type: string
            example: G1
          description: "타겟 학년으로 필터링합니다."
        - name: language_id
          in: query
          required: false
          schema:
            type: string
            example: JP
          description: "타겟 언어로 필터링합니다."
        - name: author_id
          in: query
          required: false
          schema:
            type: string
          description: "교수 또는 관리자가 특정 작성자의 공지를 필터링하기 위해 사용합니다. (예: '내가 쓴 글' 기능)"
      responses:
        "200":
          description: 공지사항 목록 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  total:
                    type: integer
                    description: "필터 조건에 맞는 전체 공지사항 개수"
                    example: 35
                  notices:
                    type: array
                    items:
                      $ref: '#/components/schemas/NoticeSummary'
    post:
      tags: [Notices]
      summary: 공지사항 생성 (관리자/교수용)
      description: 새로운 공지사항을 생성합니다.
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              $ref: "#/components/schemas/NoticeCreateRequest"
            examples:
              DefaultExample:
                summary: "일반적인 공지사항 생성 예시"
                value:
                  title: "10월 신규 기능 업데이트 안내"
                  content: "안녕하세요. 10월에 새롭게 추가된 기능을 안내드립니다."
                  course_id: "COURSE-G1-01"
                  targets: '[{"target_grade_id": "G1", "target_level_id": "N1", "target_language_id": "JP"}]'
                  files: "update_guide.pdf"
      responses:
        "200":
          description: "공지사항 생성 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  noticeId:
                    type: integer
                    example: 101
        "400":
          description: |
            - 제목 또는 내용이 비어있을 경우
            - 존재하지 않는 course_id를 지정한 경우
            - targets의 JSON 형식이 잘못된 경우
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: "교수가 담당하지 않는 과목의 공지를 작성하려는 경우"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notices/form/courses:
    get:
      tags:
        - Notices
      summary: 공지사항 생성/수정 폼에 필요한 과목 목록 조회
      description: |
        - 교수: 자신의 과목만 선택 가능 (자동 필터링)
        - 관리자: 모든 과목 선택 가능
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: course_type
          required: false
          description: 과목 타입으로 필터링합니다.
          schema:
            type: string
            enum: [regular, special, korean]
            example: regular
        - in: query
          name: grade_id
          description: 학년으로 필터링합니다.
          schema:
            type: string
            example: '1'
      responses:
        '200':
          description: 성공적으로 과목 목록을 조회한 경우
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id:
                      type: string
                      example: 'C001'
                    title:
                      type: string
                      example: '인공지능 개론'
                    grade_id:
                      type: string
                      example: '2'
                    course_type:
                      type: string
                      example: 'regular'


  /notices/{noticeId}:
    get:
      tags: [Notices]
      summary: 공지사항 상세 조회
      description: |
        특정 공지사항의 상세 내용을 조회합니다.
        - 관리자/교수는 모든 공지를 조회할 수 있습니다.
        - 학생은 자신이 수신 대상(notice_delivery_status)으로 지정된 공지만 조회할 수 있습니다.
        - 학생이 이 API를 호출하면 자동으로 '읽음' 처리됩니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: 공지사항 상세 정보 반환
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoticeDetail"
        "403":
          description: "조회 권한이 없는 공지에 접근하려는 경우"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    patch:
      tags:
        - Notices
      summary: 공지사항 수정 (관리자/교수용)
      description: 특정 공지사항의 내용을 수정합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          multipart/form-data:
            schema:
              type: object
              properties:
                title:
                  type: string
                  description: "공지사항 제목"
                content:
                  type: string
                  description: "공지사항 본문 내용"
                is_pinned:
                  type: boolean
                  description: "상단 고정 여부"
                course_id:
                  type: string
                  description: "연결할 과목 ID"
                targets:
                  type: string
                  description: "새롭게 설정할 공지 대상 배열 (JSON 문자열)"
                existing_file_ids:
                  type: string
                  description: "유지할 기존 첨부파일들의 ID 목록 (JSON 문자열 배열). 이 목록에 없는 기존 파일은 삭제됩니다."
                files:
                  type: array
                  items:
                    type: string
                    format: binary
                  description: "새롭게 추가할 첨부파일"
      responses:
        "200":
          description: 공지사항 수정 성공
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/NoticeDetail"
        "400":
          description: |
            - 수정할 내용이 없는 경우
            - 제목 또는 내용을 빈 값으로 수정하려는 경우
            - 존재하지 않는 course_id로 변경하려는 경우
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: |
            - 다른 사람의 공지를 수정하려는 경우
            - 담당하지 않는 과목의 공지로 수정하려는 경우
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: 대상 공지 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
    delete:
      tags: [Notices]
      summary: 공지사항 삭제 (관리자/교수용)
      description: 특정 공지사항을 삭제합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "204":
          description: 공지사항 삭제 성공 (본문 없음)
        "403":
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "404":
          description: 대상 공지 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notices/{noticeId}/dispatch:
    post:
      tags: [Notices]
      summary: 공지의 대상자에게 메시지 발송
      description: |
        - noticeId에 해당하는 공지 내용을 기반으로, 해당 공지에 설정된 타겟(학년/레벨 등)에게 알림을 발송합니다.
        - 대상자는 서버에서 자동으로 조회합니다.
        - 대량 발송은 비동기로 처리하고 job_id를 반환합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      requestBody:
        description: (선택 사항) 발송 옵션을 지정합니다.
        required: false
        content:
          application/json:
            schema:
              type: object
              properties:
                mock:
                  type: boolean
                  description: "true일 경우 실제 발송 없이 DB 상태만 SENT로 변경하고 즉시 결과를 반환합니다."
                  default: true
                channel:
                  type: string
                  enum: [KAKAO]
                  default: KAKAO
            example:
              mock: true
      responses:
        "200":
          description: "발송 처리 완료. mock=true인 경우 즉시 처리 결과를, mock=false인 경우 큐 적재 결과를 반환합니다."
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id:
                    type: string
                  accepted:
                    type: integer
                    description: "성공적으로 발송(또는 처리)된 수신자 수"
                  rejected:
                    type: integer
                    description: "발송 실패한 수신자 수"
                  reason:
                    type: string
                    description: "처리 결과에 대한 요약 메시지"
        "400":
          description: 잘못된 템플릿 변수/수신자 정보
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"
        "403":
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notices/{noticeId}/status:
    get:
      tags: [Notices]
      summary: 공지사항 수신자 및 읽음 현황 조회 (관리자/교수용)
      description: 특정 공지사항을 수신한 모든 사용자와 각 사용자의 읽음 상태를 조회합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "200":
          description: 수신자 목록 및 읽음 현황 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: "#/components/schemas/NoticeReadStatus"
        "403":
          description: 권한 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  /notices/{noticeId}/read:
    patch:
      tags: [Notices]
      summary: 공지 읽음 처리 (학생 본인)
      description: 현재 로그인한 사용자의 읽음 상태를 갱신합니다. 멱등적으로 동작합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: noticeId
          in: path
          required: true
          schema: { type: integer }
      responses:
        "204":
          description: 읽음 처리 완료 (본문 없음)
        "404":
          description: 대상 공지 또는 수신 행을 찾을 수 없음
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"

  # === TIMETABLE SECTION ===

  /timetables/registerCourses:
    post:
      summary: 과목 등록 (정규 / 특강 / 한국어)
      tags: [Timetable]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [sec_id, title, professor_id, target]
              properties:
                sec_id:
                  type: string
                  example: "2025-1"
                title:
                  type: string
                  example: "JLPT 특강"
                professor_id:
                  type: integer
                  example: 8888001
                target:
                  type: string
                  enum: ["1", "2", "3", "special", "korean"]
                  example: "special"
                level_id:
                  type: string
                  description: 특강/한국어일 경우 레벨 ID
                  example: "2"
            examples:
              regular:
                summary: 정규 과목 등록
                value:
                  sec_id: "2025-1"
                  title: "데이터베이스"
                  professor_id: 8888001
                  target: "2"
              special:
                summary: 특강 과목 등록
                value:
                  sec_id: "2025-1"
                  title: "JLPT 특강"
                  professor_id: 8888001
                  target: "special"
                  level_id: "2"
              korean:
                summary: 한국어 과목 등록
                value:
                  sec_id: "2025-1"
                  title: "TOPIK 6급 대비반"
                  professor_id: 8888003
                  target: "korean"
                  level_id: "5"
      responses:
        "200":
          description: 과목 등록 완료



  /timetables/registerHoliday:
    post:
      summary: 휴‧보강 등록
      tags: [Timetable]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                event_type:
                  type: string
                  enum: [CANCEL, MAKEUP]
                  example: CANCEL
                event_date:
                  type: string
                  format: date
                  example: "2025-10-05"
                course_id:
                  type: string
                  example: "C001"
                start_period:
                  type: integer
                  description: 시작 교시 (휴강일 경우 필수)
                  example: 1
                end_period:
                  type: integer
                  description: 종료 교시 (휴강일 경우 필수)
                  example: 2
                classroom:
                  type: string
                  description: 강의실 (휴강/보강 공통)
                  example: "본관-101"
                cancel_event_ids:
                  type: array
                  description: 보강 대상 휴강 이벤트 ID 목록 (보강일 경우 필수)
                  items:
                    type: string
                  example: ["E002", "E003"]
            examples:
              cancel:
                summary: 휴강 등록
                value:
                  event_type: CANCEL
                  event_date: "2025-10-05"
                  course_id: "C001"
                  start_period: 1
                  end_period: 2
                  classroom: "본관-101"
              makeup:
                summary: 보강 등록
                value:
                  event_type: MAKEUP
                  event_date: "2025-10-15"
                  cancel_event_ids: ["E002"]
                  classroom: "강의동-305"
      responses:
        "200":
          description: 이벤트 등록 완료


  /timetables/events/{id}:
    delete:
      summary: 휴‧보강 취소
      tags: [Timetable]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: 이벤트 삭제 완료 }


  /timetables/registerTimetable:
    post:
      summary: 시간표 등록 (정규 / 특강 / 한국어)
      tags: [Timetable]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required: [course_id, classroom_id, day_of_week, start_period, end_period]
              properties:
                course_id:
                  type: string
                  example: "C001"
                classroom_id:
                  type: string
                  example: "202"
                day_of_week:
                  type: string
                  enum: [MON, TUE, WED, THU, FRI]
                  example: MON
                start_period:
                  type: integer
                  example: 5
                end_period:
                  type: integer
                  example: 7
            examples:
              regular:
                summary: 정규 과목 시간표 등록
                value:
                  classroom_id: "202"
                  course_id: "C001"
                  day_of_week: "MON"
                  start_period: 5
                  end_period: 7
              special:
                summary: 특강 시간표 등록
                value:
                  classroom_id: "305"
                  course_id: "C003"
                  day_of_week: "FRI"
                  start_period: 3
                  end_period: 4
                  class_name: "A"
              korean:
                summary: 한국어 시간표 등록
                value:
                  classroom_id: "201"
                  course_id: "C004"
                  day_of_week: "TUE"
                  start_period: 1
                  end_period: 2
      responses:
        "200":
          description: 시간표 등록 완료



  /timetables/{type}/{id}:
    put:
      summary: 시간표 수정
      tags: [Timetable]
      parameters:
        - in: path
          name: type
          required: true
          schema: { type: string, enum: [regular, special, korean] }
        - in: path
          name: id
          required: true
          schema: { type: string }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                classroom_id: { type: string, example: "102" }
                day_of_week:
                  type: string
                  enum: [MON, TUE, WED, THU, FRI]
                  example: TUE
                time_slot_id: { type: string, example: "2" }
              additionalProperties: true
      responses:
        "200": { description: 수정 완료 }
    delete:
      summary: 시간표 삭제
      tags: [Timetable]
      parameters:
        - in: path
          name: type
          required: true
          schema: { type: string, enum: [regular, special, korean] }
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: 삭제 완료 }


  /timetables/grid:
    get:
      summary: 주간 시간표 그리드 조회 (요일→교시 매핑)
      description: |
        user_id와 기준 date(주 중 아무 날짜)를 받아, 해당 주(MON~FRI) × 교시(1~12) 형태의 그리드로 반환.
        - 방학/휴일 등은 비어 있을 수 있음
        - event 값은 수업 이벤트가 있을 때만 CANCEL/MAKEUP, 없으면 null
      tags: [Timetable]
      security:
        - bearerAuth: []
      parameters:
        - in: query
          name: user_id
          required: true
          schema: { type: string, example: "2423001" }
          description: 학생/교수 시스템 ID (DB user_account.user_id)
        - in: query
          name: role
          required: true
          schema: { type: string, enum: [student, professor, admin] }
          description: 조회 주체에 따른 필터링(학생=수강, 교수=담당)
        - in: query
          name: date
          required: true
          schema: { type: string, format: date, example: "2025-04-16" }
          description: 포함 주의 임의 날짜(백엔드는 이 날짜로 week_start/week_end 계산)
      responses:
        "200":
          description: OK
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimetableGrid"
              examples:
                sample:
                  value:
                    meta:
                      week_start: "2025-04-14"
                      week_end: "2025-04-18"
                      period_times:
                        "1": { start: "09:00:00", end: "09:50:00" }
                        "2": { start: "10:00:00", end: "10:50:00" }
                    MON: { "1": null, "2": null, "3": null, "4": null, "5": null, "6": null, "7": null, "8": null, "9": null, "10": null, "11": null, "12": null }
                    TUE: { "1": null, "2": null, "3": null, "4": null, "5": null, "6": null, "7": null, "8": null, "9": null, "10": null, "11": null, "12": null }
                    WED:
                      "1": null
                      "2":
                        course_id: "C001"
                        title: "인공지능 개론"
                        room: "본관-101"
                        professor: "이교수"
                        level: null
                        event: null
                      "3": null
                      "4": null
                      "5": null
                      "6": null
                      "7": null
                      "8": null
                      "9": null
                      "10": null
                      "11": null
                      "12": null
                    THU:
                      "1": null
                      "2": null
                      "3": null
                      "4": null
                      "5": null
                      "6": null
                      "7": null
                      "8": null
                      "9": null
                      "10": null
                      "11":
                        course_id: "C008"
                        title: "TOPIK 4급 한국어 특강"
                        room: "실습동-202"
                        professor: "박교수"
                        level: "TOPIK 4급"
                        event: null
                      "12": null
                    FRI:
                      "1": null
                      "2": null
                      "3": null
                      "4": null
                      "5": null
                      "6": null
                      "7": null
                      "8": null
                      "9":
                        course_id: "C006"
                        title: "네트워크"
                        room: "실습동-201"
                        professor: "이교수"
                        level: null
                        event: CANCEL
                      "10": null
                      "11": null
                      "12": null
        "400": { description: 잘못된 요청 (파라미터 누락/형식 오류) }
        "401": { description: 인증 실패 }
        "403": { description: 권한 부족 }


  /timetables/student/{user_id}:
    get:
      summary: 학생 시간표 조회 (주간)
      description: |
        특정 학생의 주간 시간표를 조회합니다.  
        - 정규 수업, 특강, 한국어, 상담(후카) 일정이 모두 포함됩니다.  
        - 요청한 날짜(`date`)가 속한 주간 범위를 서버에서 계산하여 해당 주차의 모든 일정을 반환합니다.
      tags: [Timetable]
      parameters:
        - in: path
          name: user_id
          required: true
          schema: { type: string, example: "2423004" }
          description: 학생의 사용자 ID
        - in: query
          name: date
          required: true
          schema: { type: string, format: date, example: "2025-10-20" }
          description: 조회 기준 날짜 (서버가 자동으로 해당 주의 시작/종료일 계산)
      responses:
        "200":
          description: 주간 시간표 데이터 (수업 + 상담 포함)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimetableWeeklyResponse"
        "404":
          description: 해당 학생의 시간표가 존재하지 않습니다.
        "500":
          description: 서버 내부 오류


  /timetables/professor/{user_id}:
    get:
      summary: 교수 시간표 조회 (주간)
      description: |
        특정 교수의 주간 시간표를 조회합니다.  
        - 담당 수업 및 교수 상담(후카) 일정이 포함됩니다.  
        - 학기 범위(`section`) 및 주차(`week_start ~ week_end`) 기준으로 필터링됩니다.
      tags: [Timetable]
      parameters:
        - in: path
          name: user_id
          required: true
          schema: { type: string, example: "8888001" }
          description: 교수의 사용자 ID
        - in: query
          name: date
          required: true
          schema: { type: string, format: date, example: "2025-10-20" }
          description: 조회 기준 날짜 (서버가 해당 주차 범위를 자동 계산)
      responses:
        "200":
          description: 주간 시간표 데이터 (수업 + 상담 포함)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/TimetableWeeklyResponse"
        "404":
          description: 해당 교수의 시간표가 존재하지 않습니다.
        "500":
          description: 서버 내부 오류


  /timetables/admin:
    get:
      summary: 전체 시간표 조회 (주간)
      description: |
        관리자가 전체 학과의 주간 시간표를 조회합니다.  
        - **1~3학년**, **특강**, **한국어**, **상담(후카)** 일정이 모두 포함됩니다.  
        - 주간 범위는 `week_start`, `week_end` 파라미터로 지정합니다.  
        - 휴강(`CANCEL`) 및 보강(`MAKEUP`) 이벤트도 반영됩니다.
      tags: [Timetable]
      parameters:
        - in: query
          name: week_start
          required: true
          schema:
            type: string
            format: date
            example: "2025-10-20"
          description: 주간 시작일 (월요일 기준)
        - in: query
          name: week_end
          required: true
          schema:
            type: string
            format: date
            example: "2025-10-26"
          description: 주간 종료일 (일요일 기준)
      responses:
        "200":
          description: |
            학년별 주간 시간표 데이터  
            (정규 수업, 특강, 한국어, 상담, 휴강/보강 포함)
          content:
            application/json:
              schema:
                type: object
                properties:
                  "1학년":
                    $ref: "#/components/schemas/TimetableWeeklyResponse"
                  "2학년":
                    $ref: "#/components/schemas/TimetableWeeklyResponse"
                  "3학년":
                    $ref: "#/components/schemas/TimetableWeeklyResponse"
                  "특강":
                    $ref: "#/components/schemas/TimetableWeeklyResponse"
                  "한국어":
                    $ref: "#/components/schemas/TimetableWeeklyResponse"
        "400":
          description: 잘못된 요청 (파라미터 누락 또는 형식 오류)
        "500":
          description: 서버 내부 오류




  /timetables/classes/{class_id}/assign:
    post:
      summary: 특강 분반 등록 (학생 배정)
      description: |
        선택한 반(`class_id`)에 여러 명의 학생을 일괄 배정합니다.  
        이미 등록된 학생이 있을 경우 덮어쓰기 방식으로 업데이트되며,  
        모든 쿼리는 트랜잭션으로 처리되어 일부 실패 시 전체 롤백됩니다.
      tags: ["Timetable"]
      parameters:
        - name: class_id
          in: path
          required: true
          schema:
            type: string
          example: C007A
          description: "반 고유 ID (예: C007A)"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                student_ids:
                  type: array
                  items:
                    type: string
                  example: ["2423004", "2524001"]
                  description: 배정할 학생의 user_id 배열
      responses:
        "200":
          description: 분반 등록 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "등록 완료"
                  result:
                    type: object
                    properties:
                      message:
                        type: string
                        example: "2명의 학생이 C007A 반에 배정되었습니다."
        "400":
          description: 잘못된 요청 (필수 파라미터 누락)
        "401":
          description: 인증 실패 (JWT 누락 또는 만료)
        "500":
          description: 서버 내부 오류 (DB 트랜잭션 실패 등)



  /timetables/huka/student:
    get:
      summary: 학생 상담 시간표 조회
      tags: ["Timetable"]
      description: >
        교수, 관리자, 학생 모두 상담 시간표를 조회할 수 있습니다.  
        (정규 상담 및 일회성 상담 모두 반환합니다)
      parameters:
        - name: user_id
          in: query
          required: false
          schema:
            type: string
          description: 조회할 사용자 ID (교수/학생 ID)
        - name: targetDate
          in: query
          required: false
          schema:
            type: string
            format: date
            example: "2025-10-08"
          description: 조회 기준 날짜 (주차 단위 계산용)
      responses:
        "200":
          description: 상담 시간표 데이터
          content:
            application/json:
              schema:
                type: object
                properties:
                  MON:
                    type: object
                    example:
                      "8": { "student": "국내1-JP-A", "location": "실습동301호" }
                      "9": { "student": "2423004", "location": "본관201호" }
    post:
      summary: 정규 상담 등록 (매주 고정 상담)
      tags: ["Timetable"]
      description: >
        여러 학생을 대상으로 특정 요일·교시 범위의 **정규 상담 일정을 등록**합니다.  
        `time_slot_id`는 자동 매핑됩니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                student_ids:
                  type: array
                  items:
                    type: string
                  example: ["2423004", "2423005"]
                sec_id:
                  type: string
                  example: "2025-1"
                day_of_week:
                  type: string
                  enum: ["MON", "TUE", "WED", "THU", "FRI"]
                start_slot:
                  type: integer
                  example: 8
                end_slot:
                  type: integer
                  example: 9
                location:
                  type: string
                  example: "실습동 301호"
      responses:
        "200":
          description: 등록 완료
          content:
            application/json:
              schema:
                type: object
                example:
                  message: "2명의 정규 상담 일정이 등록되었습니다."


  /timetables/huka/student/custom:
    post:
      summary: 일회성 상담 등록 (개별 일정 수정)
      tags: ["Timetable"]
      description: >
        특정 주차의 **개별(임시) 상담 일정을 등록**합니다.  
        같은 주차의 `REGULAR` 상담은 자동으로 덮어씌워집니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                student_ids:
                  type: array
                  items:
                    type: string
                  example: ["2423004"]
                sec_id:
                  type: string
                  example: "2025-1"
                date:
                  type: string
                  format: date
                  example: "2025-10-15"
                start_slot:
                  type: integer
                  example: 9
                end_slot:
                  type: integer
                  example: 10
                location:
                  type: string
                  example: "본관 201호"
      responses:
        "200":
          description: 수정 상담 등록 완료
          content:
            application/json:
              schema:
                type: object
                example:
                  message: "1명의 상담 일정이 수정되었습니다."


  /timetables/events:
    get:
      summary: 휴보강 이력 조회
      description: 전체 휴보강 이력을 조회합니다. (프론트에서 학년/과목 필터링 처리)
      tags:
        - Timetable
      responses:
        "200":
          description: 휴보강 이력 목록
          content:
            application/json:
              schema:
                type: object
                properties:
                  result:
                    type: array
                    items:
                      type: object
                      properties:
                        event_status:
                          type: string
                          example: "MAKEUP"
                          description: "휴강/보강 상태 (CANCEL=휴강, MAKEUP=보강)"
                        event_date:
                          type: string
                          format: date-time
                          example: "2025-10-19"
                          description: "휴보강 발생일"
                        grade_id:
                          type: string
                          nullable: true
                          example: "2"
                          description: "학년 ID (특강의 경우 NULL)"
                        grade_name:
                          type: string
                          nullable: true
                          example: "2학년"
                          description: "학년 이름 (특강의 경우 NULL)"
                        course_id:
                          type: string
                          example: "C001"
                          description: "과목 ID"
                        course_title:
                          type: string
                          example: "인공지능 개론"
                          description: "과목명"
                        start_time:
                          type: string
                          format: time
                          example: "09:00:00"
                          description: "수업 시작 교시 시간"
                        end_time:
                          type: string
                          format: time
                          example: "09:50:00"
                          description: "수업 종료 교시 시간"


  # === CLASSROOM SECTION ===

  /classrooms:
    get:
      summary: 강의실 목록 조회
      tags: [Classroom]
      responses:
        "200":
          description: 강의실 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    classroom_id: { type: string, example: "101" }
                    building: { type: string, example: 본관 }
                    room_number: { type: string, example: "101" }
                    room_type: { type: string, example: 강의실 }
    post:
      summary: 강의실 등록
      tags: [Classroom]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                building: { type: string, example: 본관 }
                room_number: { type: string, example: "404" }
                room_type: { type: string, example: 수업 }
      responses:
        "200": { description: 등록 완료 }


  /classrooms/{id}:
    put:
      summary: 강의실 수정
      tags: [Classroom]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                building: { type: string, example: 신관 }
                room_number: { type: string, example: "302" }
                room_type: { type: string, example: 회의 }
      responses:
        "200": { description: 수정 완료 }
    delete:
      summary: 강의실 삭제
      tags: [Classroom]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        "200": { description: 삭제 완료 }


  /classrooms/purposes:
    get:
      summary: 강의실 사용 목적 목록 조회
      tags: [Classroom]
      responses:
        "200":
          description: 목적 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    purpose: { type: string, example: 수업 }


  /classrooms/{classroom_id}/reservations:
    get:
      summary: 특정 강의실의 주간 예약 현황 조회
      description: |
        선택한 날짜(`date`)를 기준으로 해당 주(월~일)에 포함되는 예약 내역을 반환합니다.  
        날짜 범위는 백엔드에서 자동 계산되며, 사용자 이름(`user_name`)이 함께 표시됩니다.
      tags:
        - Classroom - Reservation
      parameters:
        - in: path
          name: classroom_id
          required: true
          schema:
            type: string
          description: "강의실 ID (예: CR001)"
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
          example: "2025-10-13"
          description: 주간 예약을 조회할 기준 날짜
      responses:
        "200":
          description: 주간 예약 현황
          content:
            application/json:
              schema:
                type: object
                properties:
                  MON:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  TUE:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  WED:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  THU:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  FRI:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  SAT:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
                  SUN:
                    type: array
                    items:
                      $ref: '#/components/schemas/ClassroomReservationItem'
    post:
      summary: 강의실 예약 등록
      description: |
        로그인된 사용자(`req.user.user_id`)를 기준으로 강의실 예약을 등록합니다.  
        중복 시간대 예약은 서버에서 방지됩니다.
      tags:
        - Classroom - Reservation
      parameters:
        - in: path
          name: classroom_id
          required: true
          schema:
            type: string
          description: "강의실 ID (예: CR001)"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                reservation_date:
                  type: string
                  format: date
                  example: "2025-10-20"
                  description: 예약 날짜
                start_time:
                  type: string
                  example: "09:00:00"
                  description: 예약 시작 시간
                end_time:
                  type: string
                  example: "10:00:00"
                  description: 예약 종료 시간
      responses:
        "200":
          description: 예약 완료
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "예약 완료"
                  result:
                    type: object
                    properties:
                      affectedRows:
                        type: integer
                        example: 1


  /classrooms/{classroom_id}/reservations/{reservation_id}:
    delete:
      summary: 강의실 예약 취소
      description: |
        지정한 강의실(`classroom_id`)의 특정 예약(`reservation_id`)을 삭제합니다.  
        예약이 존재하지 않으면 404 응답을 반환합니다.
      tags:
        - Classroom - Reservation
      parameters:
        - in: path
          name: classroom_id
          required: true
          schema:
            type: string
          description: "강의실 ID (예: CR001)"
        - in: path
          name: reservation_id
          required: true
          schema:
            type: string
          description: 예약 고유 ID (AUTO_INCREMENT 값)
      responses:
        "200":
          description: 예약 취소 완료
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "삭제 완료"
                  result:
                    type: object
                    properties:
                      affectedRows:
                        type: integer
                        example: 1
        "404":
          description: 해당 예약을 찾을 수 없음
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "해당 예약을 찾을 수 없습니다."


  # === POLL SECTION ===

  /classrooms/polls:
    get:
      summary: 주말 강의실 투표 현황 조회
      description: |
        선택한 날짜(`date`)가 포함된 주(월~일)의 강의실 개방 투표 현황을 조회합니다.  
        각 투표는 학년, 날짜, 요일(토요일·일요일), 정원, 현재 참여 인원 수,  
        그리고 **현재 로그인한 사용자가 투표에 참여했는지 여부(`user_voted`)** 를 포함합니다.  
        더 이상 `SAT`, `SUN` 구분 없이 하나의 배열 형태로 반환됩니다.
      tags:
        - Classroom - Poll
      parameters:
        - in: query
          name: date
          required: true
          schema:
            type: string
            format: date
            example: "2025-10-13"
          description: 기준 날짜 (해당 주의 투표 현황을 조회)
      responses:
        "200":
          description: 주말 투표 현황 데이터
          content:
            application/json:
              schema:
                type: array
                items:
                  $ref: '#/components/schemas/WeekendPollItem'
              example:
                - poll_id: "P001"
                  grade_name: "1학년"
                  poll_date: "2025-10-17"
                  day_of_week: "토요일"
                  required_count: 8
                  vote_count: 4
                  is_opened: false
                  user_voted: true
                - poll_id: "P002"
                  grade_name: "2학년"
                  poll_date: "2025-10-18"
                  day_of_week: "일요일"
                  required_count: 10
                  vote_count: 0
                  is_opened: false
                  user_voted: false
        "500":
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
    post:
      summary: 강의실 개방 투표 생성
      description: |
        새로운 주말 강의실 개방 투표를 등록합니다.  
        동일한 강의실(`classroom_id`), 날짜(`poll_date`), 요일(`target_weekend`) 조합은 중복 생성이 불가합니다.  
        투표 ID(`poll_id`)는 서버에서 자동으로 `P001`, `P002` 형태로 생성됩니다.
      tags:
        - Classroom - Poll
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - grade_id
                - classroom_id
                - poll_date
                - target_weekend
                - required_count
              properties:
                grade_id:
                  type: string
                  example: "1"
                  description: 학년 ID (1~3)
                classroom_id:
                  type: string
                  example: "CR001"
                  description: 강의실 ID
                poll_date:
                  type: string
                  format: date
                  example: "2025-10-24"
                  description: 투표 일자 (YYYY-MM-DD)
                target_weekend:
                  type: string
                  enum: [SAT, SUN]
                  example: "SAT"
                  description: 주말 구분 (`SAT` 또는 `SUN`)
                required_count:
                  type: integer
                  example: 8
                  description: 개방 기준 인원수
      responses:
        "201":
          description: 투표 생성 완료
          content:
            application/json:
              schema:
                type: object
                properties:
                  poll_id:
                    type: string
                    example: "P005"
                    description: 새로 생성된 투표 ID
                  message:
                    type: string
                    example: "투표가 성공적으로 생성되었습니다."
        "400":
          description: 잘못된 요청 (필드 누락 또는 중복 투표)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  /classrooms/polls/{poll_id}/vote:
    post:
      summary: 투표 신청 / 취소
      description: |
        특정 투표(`poll_id`)에 대해 학생이 **신청** 또는 **취소**할 수 있습니다.  
        `action` 값에 따라 다음과 같이 동작합니다.  
        - `apply`: 투표 신청  
        - `cancel`: 투표 취소  
        <br>  
        `user_id`는 JWT 토큰에서 자동으로 추출됩니다.
      tags:
        - Classroom - Poll
      parameters:
        - in: path
          name: poll_id
          required: true
          schema:
            type: string
          description: "투표 ID (예: P001)"
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              required:
                - action
              properties:
                action:
                  type: string
                  enum: [apply, cancel]
                  example: apply
                  description: "투표 신청(`apply`) 또는 취소(`cancel`)"
      responses:
        "200":
          description: 요청 성공
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "투표 신청 완료"
        "400":
          description: 잘못된 요청 (이미 신청한 투표 또는 잘못된 action 값)
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
              example:
                error: "이미 투표에 참여했습니다."
        "404":
          description: 취소 요청 시, 해당 투표에 참여하지 않았을 경우
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'
        "500":
          description: 서버 내부 오류
          content:
            application/json:
              schema:
                $ref: '#/components/schemas/ErrorResponse'


  # === FILES SECTION ===

  /files/{file_id}/download:
    get:
      tags:
        - Files
      summary: 파일 다운로드
      description: |
        - 지정된 file_id에 해당하는 파일을 다운로드합니다.
      security:
        - bearerAuth: []
      parameters:
        - in: path
          name: file_id
          required: true
          description: 다운로드할 파일의 고유 ID
          schema:
            type: integer
            example: 101
      responses:
        '200':
          description: 성공적인 파일 다운로드. 파일의 실제 바이너리 데이터가 반환됩니다.
          content:
            # 파일 타입은 매우 다양하므로, 와일드카드 사용
            '*/*':
              schema:
                type: string
                format: binary
        '404':
          description: 해당 file_id를 가진 파일을 찾을 수 없는 경우
          content:
            application/json:
              schema:
                type: object
                properties:
                  message:
                    type: string
                    example: "파일을 찾을 수 없습니다."


  # === CLEANING SECTION ===

  /cleaning-rosters:
    get:
      tags: [Cleaning]
      summary: 주간 청소 당번 조회
      description: 특정 학년 또는 특정 날짜를 기준으로 배정된 청소 당번 목록을 조회합니다.
      security:
        - bearerAuth: []
      parameters:
        - name: grade_id
          in: query
          required: false
          schema: { type: string, example: G1 }
        - name: date
          in: query
          required: true
          schema:
            type: string
            format: date
          description: "조회하고 싶은 주(week)의 아무 날짜나 입력 (예: 2025-09-15)"
      responses:
        "200":
          description: 청소 당번 목록 반환
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/CleaningRosterResponse"
    delete:
      tags:
        - Cleaning
      summary: 특정 학년의 학기별 청소 당번 삭제
      description: |
        지정된 학기(section)의 특정 학년(grade_id)에 해당하는 모든 청소 당번 데이터를 삭제합니다.
        **안정성을 위해 학년(grade_id) 지정은 필수입니다.**
      security:
        - bearerAuth: [ ] # 관리자만 가능
      parameters:
        - name: section
          in: query
          required: true
          description: 삭제할 학기
          schema:
            type: string
            example: "2025-2"
        - name: grade_id
          in: query
          required: true
          description: 삭제할 학년 ID
          schema:
            type: string
            example: 1
      responses:
        "200":
          description: 삭제 성공
        "400":
          description: 잘못된 요청 (필수 파라미터 누락)
        "403":
          description: 권한 없음 (관리자 X)
        "404":
          description: 삭제할 데이터를 찾을 수 없음

  /cleaning-rosters/generate:
    post:
      tags:
        - Cleaning
      summary: 학기 전 주차/전 학년 로스터 자동 생성
      description: 학기 시작 시 한 번 실행하여 주간 로스터를 자동 생성합니다. **이미 데이터가 존재하는 주차는 새로운 팀으로 덮어쓰므로, 여러 번 실행해도 안전합니다.**
      security:
        - bearerAuth: [ ]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/GenerateRostersRequest"
            examples:
              default:
                value:
                  section: "2025-2"
                  weekday: "MON"
                  team_size: 4
                  grade_rooms:
                    - { grade_id: "1", classroom_id: "C-304" }
                    - { grade_id: "2", classroom_id: "C-405" }
      responses:
        "201":
          description: 생성 결과 요약
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/GenerateRostersResult"
        "400":
          description: 잘못된 요청(파라미터/형식 오류)
        "409":
          description: 충돌(잘못된 중복 또는 생성 불가 주차)


  # === MODAL SECTION ===

  /modal/sections:
    get:
      summary: 학기 목록 조회
      tags: ["Modal - Common"]
      responses:
        "200":
          description: 학기 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    sec_id: { type: string, example: 2025-1 }
                    label: { type: string, example: 2025-1 }


  /modal/professors:
    get:
      summary: 교수 목록 조회
      tags: ["Modal - Common"]
      responses:
        "200":
          description: 교수 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    user_id: { type: string, example: P001 }
                    name: { type: string, example: 이교수 }


  /modal/classrooms:
    get:
      summary: 강의실 목록 조회
      tags: ["Modal - Common"]
      responses:
        "200":
          description: 강의실 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    classroom_id: { type: string, example: "101" }
                    building: { type: string, example: 본관 }
                    room_number: { type: string, example: "101" }


  /modal/timeslots:
    get:
      summary: 교시 목록 조회
      tags: ["Modal - Common"]
      responses:
        "200":
          description: 교시 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    time_slot_id: { type: string, example: "1" }
                    start_time: { type: string, example: "09:00:00" }
                    end_time: { type: string, example: "09:50:00" }


  /modal/days:
    get:
      summary: 요일 목록 조회
      tags: ["Modal - Common"]
      responses:
        "200":
          description: 요일 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    day_of_week: { type: string, example: 월 }


  /modal/courses/regular:
    get:
      summary: 정규 과목 목록 조회 (학년별)
      tags: ["Modal - Subjects"]
      parameters:
        - in: query
          name: grade_id
          required: true
          schema:
            type: string
            enum: ["1", "2", "3"]
          description: 학년 ID
          example: "2"
      responses:
        "200":
          description: 정규 과목 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id: { type: string, example: "C001" }
                    title: { type: string, example: "인공지능 개론" }


  /modal/courses/special:
    get:
      summary: 특강 과목 목록 조회
      tags: ["Modal - Subjects"]
      responses:
        "200":
          description: 특강 과목 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id: { type: string, example: "SP001" }
                    title: { type: string, example: "JLPT 특강" }
                    class_id: { type: string, example: "1" }
                    class_name: { type: string, example: "A" }


  /modal/courses/special/classes:
    get:
      summary: "특강 분반 조회 (level_id 없이 전체)"
      description: >
        특강 과목(course.is_special = TRUE)에 속한 모든 반(class) 목록을 조회합니다.  
        각 항목은 과목명, 반 ID, 반 이름 등을 포함합니다.
      tags: ["Modal - Subjects"]
      security:
        - BearerAuth: []
      responses:
        "200":
          description: "특강 분반 목록 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id:
                      type: string
                      example: "C007"
                      description: "과목 ID"
                    course_name:
                      type: string
                      example: "JLPT N2 특강"
                      description: "과목명"
                    class_id:
                      type: string
                      example: "C007A"
                      description: "반 ID"
                    class_group:
                      type: string
                      example: "A"
                      description: "반 이름 (A, B 등)"
        "401":
          description: "인증 실패 (JWT 토큰 누락 또는 만료)"
        "500":
          description: "서버 내부 오류"


  /modal/courses/korean/classes:
    get:
      summary: "한국어 과목 반 조회"
      description: >
        한국어 과목(language_id = 'KR')에 속한 반(class) 목록을 조회합니다.  
        한국어 집중반, TOPIK 대비반 등 각 반의 정보를 포함합니다.
      tags: ["Modal - Subjects"]
      security:
        - BearerAuth: []
      responses:
        "200":
          description: "한국어 과목 반 목록 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id:
                      type: string
                      example: "C008"
                      description: "과목 ID"
                    course_name:
                      type: string
                      example: "TOPIK 4급 대비반"
                      description: "과목명"
                    class_id:
                      type: string
                      example: "C008A"
                      description: "반 ID"
                    class_group:
                      type: string
                      example: "A"
                      description: "반 이름 (A, B 등)"
        "401":
          description: "인증 실패 (JWT 토큰 누락 또는 만료)"
        "500":
          description: "서버 내부 오류"


  /modal/courses/korean:
    get:
      summary: 한국어 과목 목록 조회
      tags: ["Modal - Subjects"]
      responses:
        "200":
          description: 한국어 과목 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id: { type: string, example: "K001" }
                    title: { type: string, example: "TOPIK 대비 한국어" }
                    class_id: { type: string, example: "1" }
                    class_name: { type: string, example: "A" }


  /modal/courses/{course_id}/students:
    get:
      summary: "특강 학생 조회 (배정/미배정 구분)"
      description: >
        선택한 특강(course_id)에 등록된 학생 목록을 조회합니다.  
        각 학생은 class_id 존재 여부에 따라 `assigned_students`(배정됨)  
        또는 `unassigned_students`(미배정) 그룹으로 구분되어 반환됩니다.
      tags: ["Modal - Subjects"]
      security:
        - BearerAuth: []
      parameters:
        - name: course_id
          in: path
          required: true
          description: "조회할 특강의 ID (예: C003)"
          schema:
            type: string
      responses:
        "200":
          description: "특강 수강생 목록 조회 성공"
          content:
            application/json:
              schema:
                type: object
                properties:
                  all_students:
                    type: array
                    description: 전체 학생 목록
                    items:
                      type: object
                      properties:
                        user_id:
                          type: string
                          example: "2423004"
                        name:
                          type: string
                          example: "김철수"
                        email:
                          type: string
                          example: "kim@g.yju.ac.kr"
                        course_id:
                          type: string
                          example: "C003"
                        class_id:
                          type: string
                          nullable: true
                          example: null
                  assigned_students:
                    type: array
                    description: 이미 반(class)에 배정된 학생 목록
                    items:
                      type: object
                      properties:
                        user_id:
                          type: string
                          example: "2725001"
                        name:
                          type: string
                          example: "박지민"
                        email:
                          type: string
                          example: "park@g.yju.ac.kr"
                        class_id:
                          type: string
                          example: "C003A"
                  unassigned_students:
                    type: array
                    description: 아직 반에 배정되지 않은 학생 목록
                    items:
                      type: object
                      properties:
                        user_id:
                          type: string
                          example: "2423004"
                        name:
                          type: string
                          example: "김철수"
                        email:
                          type: string
                          example: "kim@g.yju.ac.kr"
                        class_id:
                          type: string
                          example: null
        "401":
          description: "인증 실패 (JWT 토큰 만료 또는 미인증)"
        "500":
          description: "서버 내부 오류"


  /modal/subjects/holidays:
    get:
      summary: 휴강 이벤트 조회 (학년별)
      tags: ["Modal - Subjects"]
      parameters:
        - in: query
          name: grade_id
          required: true
          schema:
            type: string
            enum: ["1", "2", "3"]
          description: 학년 ID (1 = 1학년, 2 = 2학년, 3 = 3학년)
          example: "2"
      responses:
        "200":
          description: 휴강 이벤트 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    event_id: { type: string, example: "E001" }
                    event_date: { type: string, format: date, example: "2025-04-15" }
                    course_title: { type: string, example: "인공지능 개론" }
                    grade_id: { type: string, example: "2" }
                    period: { type: integer, example: 1 }
                    start_time: { type: string, example: "09:00:00" }
                    end_time: { type: string, example: "09:50:00" }
            examples:
              sample:
                summary: 휴강 이벤트 예시
                value:
                  - event_id: "E001"
                    event_date: "2025-04-15"
                    course_title: "인공지능 개론"
                    grade_id: "2"
                    period: 1
                    start_time: "09:00:00"
                    end_time: "09:50:00"
                  - event_id: "E006"
                    event_date: "2025-10-05"
                    course_title: "인공지능 개론"
                    grade_id: "2"
                    period: 1
                    start_time: "09:00:00"
                    end_time: "09:50:00"
                  - event_id: "E007"
                    event_date: "2025-10-05"
                    course_title: "인공지능 개론"
                    grade_id: "2"
                    period: 2
                    start_time: "10:00:00"
                    end_time: "10:50:00"


  /modal/courses/all:
    get:
      summary: 전체 과목 목록 조회 (정규 + 특강 + 한국어)
      tags: ["Modal - Subjects"]
      responses:
        "200":
          description: 전체 과목 목록
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    course_id:
                      type: string
                      example: "C001"
                    title:
                      type: string
                      example: "인공지능 개론"
                    type:
                      type: string
                      description: 과목 구분
                      example: "정규"
                      enum: ["정규", "특강", "한국어"]
                    target:
                      type: string
                      description: 대상 분류 (학년/특강/한국어)
                      example: "2"
                      enum: ["1", "2", "3", "special", "korean"]


  /modal/schedule/{course_id}:
    get:
      summary: 특정 과목의 시간표 조회
      tags: ["Modal - Subjects"]
      parameters:
        - in: path
          name: course_id
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 특정 과목 시간표
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    schedule_id: { type: string, example: SCH1 }
                    course_id: { type: string, example: C001 }
                    title: { type: string, example: 인공지능 개론 }
                    day_of_week: { type: string, example: 월 }
                    start_time: { type: string, example: "09:00:00" }
                    end_time: { type: string, example: "09:50:00" }
                    building: { type: string, example: 본관 }
                    room_number: { type: string, example: "101" }


  # === ADMIN SECTION ===

  /admin/users:
    get:
      summary: 관리자 사용자 승인
      tags: [Admin]
      responses:
        "200":
          description: 승인대기 계정 출력
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    role_type: { type: string }
                    name: { type: string }
                    email: { type: string }
                    phone: { type: string }
                    is_international: { type: boolean }
                    level_name: { type: string }
              example:
                - id: 1
                  role_type: student
                  name: 김성식
                  email: abc@gmail.com
                  phone: 010-4628-5981
                  is_international: true
                  language_id: JLPT3
                - id: 2
                  role_type: professor
                  name: 김교수
                  email: abcd@gmail.com
                  phone: 010-1234-5678
                  professor_id: P001
    post:
      summary: 사용자 승인/거절 처리
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                user_id: { type: string, example: "2423001" }
                action:
                  type: string
                  enum: [active, inactive]
                  example: active
      responses:
        "200": { description: 승인 완료 }


  /admin/users/{id}:
    delete:
      summary: 사용자 삭제
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: 삭제 완료 }


  /admin/email:
    get:
      summary: 예외 이메일 관리
      tags: [Admin]
      responses:
        "200":
          description: "이메일 조회 성공"
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    email: { type: string }
                    reason: { type: string }
              example:
                - id: 1
                  email: aaa@gmail.com
                  reason: 김순애 교수님 계정
    post:
      summary: 예외 이메일 등록
      tags: [Admin]
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                email: { type: string, example: ccc@gmail.com }
                reason: { type: string, example: 교수 연구용 }
      responses:
        "200": { description: 등록 완료 }


  /admin/email/{id}:
    delete:
      summary: 예외 이메일 삭제
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: integer }
      responses:
        "200": { description: 삭제 완료 }


  /admin/students:
    get:
      summary: 학생 정보 관리
      tags: [Admin]
      parameters:
        - in: query
          name: grade_id
          schema: { type: integer, enum: [1, 2, 3] }
          description: 학년 (1=1학년, 2=2학년, 3=3학년)
        - in: query
          name: status
          schema: { type: string, enum: [재학, 휴학, 자퇴, 졸업] }
          description: 학생 상태
      responses:
        "200":
          description: 조건에 맞는 학생 목록 반환
          content:
            application/json:
              schema:
                type: array
                items:
                  type: object
                  properties:
                    id: { type: integer }
                    grade_id: { type: integer }
                    user_id: { type: string }
                    name: { type: string }
                    email: { type: string }
                    phone: { type: string }
                    status: { type: string }
                    language_id: { type: string }
                    level_class: { type: string }
              example:
                - id: 1
                  grade_id: 1
                  user_id: 2423001
                  name: 권혁일
                  email: aaa@gmail.com
                  phone: 010-1111-1111
                  status: 재학
                  language_id: JLPTN1
                  level_class: A
                - id: 2
                  grade_id: 2
                  user_id: 2423002
                  name: 김성식
                  email: bbb@gmail.com
                  phone: 010-2222-2222
                  status: 휴학
                  language_id: JLPTN2
                  level_class: B


  /admin/students/{user_id}:
    patch:
      summary: 학생 정보 수정
      tags: [Admin]
      parameters:
        - in: path
          name: user_id
          required: true
          schema: { type: integer }
      requestBody:
        required: true
        content:
          application/json:
            schema:
              type: object
              properties:
                name: { type: string }
                phone: { type: string }
                status: { type: string, enum: [재학, 휴학, 자퇴, 졸업] }
                grade_id: { type: integer, enum: [1, 2, 3] }
                language_id: { type: string }
                level_name: { type: string }
                class_name: { type: string }
      responses:
        "200": { description: 수정 완료 }


  /admin/students/{id}:
    delete:
      summary: 학생 삭제
      tags: [Admin]
      parameters:
        - in: path
          name: id
          required: true
          schema: { type: string }
      responses:
        "200": { description: 삭제 완료 }


  # === DISPATCH SECTION ===

  /dispatch/direct:
    post:
      tags: [Dispatch]
      summary: 특정 사용자들에게 직접 메시지 발송
      description: |
        - Request Body에 명시된 사용자 ID 목록을 대상으로 즉시 메시지를 발송합니다.
        - 공지사항과 연동되지 않습니다.
      security:
        - bearerAuth: []
      requestBody:
        required: true
        content:
          application/json:
            schema:
              $ref: "#/components/schemas/DirectMessageRequest"
      responses:
        "202":
          description: 발송 요청 접수됨(비동기)
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/KakaoEnqueueResponse"
        "400":
          description: "잘못된 요청 (예: 사용자 ID 목록이 비어있음)"
          content:
            application/json:
              schema:
                $ref: "#/components/schemas/ErrorResponse"


  /dispatch/jobs/{jobId}:
    get:
      tags: [Dispatch]
      summary: 발송 작업 상태 조회
      security:
        - bearerAuth: []
      parameters:
        - name: jobId
          in: path
          required: true
          schema: { type: string }
      responses:
        "200":
          description: 상태 반환
          content:
            application/json:
              schema:
                type: object
                properties:
                  job_id: { type: string }
                  status:
                    type: string
                    enum: [QUEUED, SENDING, PARTIAL, SUCCESS, FAILED]
                  total: { type: integer }
                  sent: { type: integer }
                  failed: { type: integer }



components:
  securitySchemes:
    bearerAuth:
      type: http
      scheme: bearer
      bearerFormat: JWT

  schemas:
    WeekMeta:
      type: object
      properties:
        week_start: { type: string, format: date, example: "2025-09-15" }
        week_end:   { type: string, format: date, example: "2025-09-21" }

    TimetableWeeklyResponse:
      type: object
      description: |
        주간 시간표 데이터는 요일별/교시별로 구조화되어 반환됩니다.
      example:
        MON:
          "1": []
          "2": []
          "3": []
          "4": []
          "5": [{ title: "웹프로그래밍", professor: "이교수", room: "본관-201", source: "CLASS" }]
          "6": [{ title: "상담", professor: "후카 교수", room: "실습동 301호", source: "COUNSELING" }]
          "7": []
        TUE:
          "1": []
          "2": []
          "3": []
          "4": []
          "5": []
          "6": []
          "7": []
        WED: { "1": [], "2": [], "3": [] }
        THU: { "1": [], "2": [], "3": [] }
        FRI: { "1": [], "2": [], "3": [] }

    TimetableCell:
      type: object
      properties:
        course_id: { type: string, example: C001 }
        title: { type: string, example: 인공지능 개론 }
        room: { type: string, example: 본관-101 }
        professor: { type: string, example: 이교수 }
        level:
          type: string
          nullable: true
          example: JLPT N2
        event:
          type: string
          nullable: true
          description: 수업 이벤트 유형 (course_event.event_type)
          enum: [CANCEL, MAKEUP]
          example: null

    PeriodMap:
      type: object
      description: "교시 1~12를 키로 가지는 맵 (값은 TimetableCell 또는 null)"
      properties:
        "1":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "2":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "3":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "4":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "5":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "6":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "7":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "8":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "9":  { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "10": { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "11": { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }
        "12": { allOf: [ { $ref: "#/components/schemas/TimetableCell" } ], nullable: true }

    TimetableGrid:
      type: object
      properties:
        meta:
          type: object
          properties:
            week_start: { type: string, format: date, example: "2025-04-14" }
            week_end: { type: string, format: date, example: "2025-04-18" }
            period_times:
              type: object
              additionalProperties:
                type: object
                properties:
                  start: { type: string, format: time, example: "09:00:00" }
                  end: { type: string, format: time, example: "09:50:00" }
              example:
                "1": { start: "09:00:00", end: "09:50:00" }
                "2": { start: "10:00:00", end: "10:50:00" }
        MON: { $ref: "#/components/schemas/PeriodMap" }
        TUE: { $ref: "#/components/schemas/PeriodMap" }
        WED: { $ref: "#/components/schemas/PeriodMap" }
        THU: { $ref: "#/components/schemas/PeriodMap" }
        FRI: { $ref: "#/components/schemas/PeriodMap" }
      example:
        meta:
          week_start: "2025-04-14"
          week_end: "2025-04-18"
          period_times:
            "1": { start: "09:00:00", end: "09:50:00" }
            "2": { start: "10:00:00", end: "10:50:00" }
        MON: { "1": null, "2": null, "3": null, "4": null, "5": null, "6": null, "7": null, "8": null, "9": null, "10": null, "11": null, "12": null }
        TUE: { "1": null, "2": null, "3": null, "4": null, "5": null, "6": null, "7": null, "8": null, "9": null, "10": null, "11": null, "12": null }
        WED:
          "1": null
          "2":
            course_id: "C001"
            title: "인공지능 개론"
            room: "본관-101"
            professor: "이교수"
            level: null
            event: null
          "3": null
          "4": null
          "5": null
          "6": null
          "7": null
          "8": null
          "9": null
          "10": null
          "11": null
          "12": null
        THU:
          "1": null
          "2": null
          "3": null
          "4": null
          "5": null
          "6": null
          "7": null
          "8": null
          "9": null
          "10": null
          "11":
            course_id: "C008"
            title: "TOPIK 4급 한국어 특강"
            room: "실습동-202"
            professor: "박교수"
            level: "TOPIK 4급"
            event: null
          "12": null
        FRI:
          "1": null
          "2": null
          "3": null
          "4": null
          "5": null
          "6": null
          "7": null
          "8": null
          "9":
            course_id: "C006"
            title: "네트워크"
            room: "실습동-201"
            professor: "이교수"
            level: null
            event: "CANCEL"
          "10": null
          "11": null
          "12": null

    CleaningRosterResponse:
      type: object
      properties:
        section:
          type: string
          example: "2025-2"
        work_date:
          type: string
          example: "2025-10-20"
        rosters:
          type: array
          items:
            $ref: "#/components/schemas/CleaningRosterItem"

    CleaningRosterItem:
        type: object
        properties:
          grade_id:
            type: string
            example: "G1"
          classroom_name:
            type: string
            example: "창조관-304"
          members:
            type: array
            items:
              type: string
            example: ['김성식', '권혁일', '정영쳘', '김민정']

    CleaningWeeklyDuty:
        type: object
        properties:
          work_date:
            type: string
            format: date
            example: "2025-09-15"
          members:
            type: array
            items:
              type: string
            example: [ "G1 Student 01", "G1 Student 02" ]

    GenerateRostersRequest:
        type: object
        required: [ section, weekday, team_size, grade_rooms ]
        properties:
          section:
            type: string
            example: "2025-2"
          weekday:
            type: string
            enum: [ MON, TUE, WED, THU, FRI ]
            example: "MON"
          team_size:
            type: integer
            minimum: 1
            maximum: 10
            example: 4
          grade_rooms:
            type: array
            minItems: 1
            items:
              $ref: "#/components/schemas/GradeRoom"

    GradeRoom:
        type: object
        required: [ grade_id, classroom_id ]
        properties:
          grade_id:
            type: string
            example: "1"
          classroom_id:
            type: string
            example: "C-304"

    GenerateRostersResult:
        type: object
        properties:
          section:
            type: string
            example: "2025-2"
          generated:
            type: object
            additionalProperties:
              type: object
              properties:
                weeks:
                  type: integer
                  example: 15
                teams:
                  type: integer
                  example: 15
                members_assigned:
                  type: integer
                  example: 60
          skipped_existing:
            type: integer
            example: 2
          conflicts:
            type: array
            items:
              type: string
            example: [ ]
    Timetable:
      type: object
      properties:
        course_id: { type: string, example: C001 }
        course_title: { type: string, example: 인공지능 개론 }
        year: { type: integer, example: 2025 }
        semester: { type: integer, example: 1 }
        day:
          type: string
          description: 요일 (course_schedule.day_of_week)
          enum: [MON, TUE, WED, THU, FRI]
          example: MON
        start_time: { type: string, format: time, example: "09:00:00" }
        end_time: { type: string, format: time, example: "09:50:00" }
        building: { type: string, example: 본관 }
        room_number: { type: string, example: "101" }
        professor_name: { type: string, example: 이교수 }
        grade_id: { type: string, nullable: true, example: "2" }
        grade_name: { type: string, nullable: true, example: 2학년 }
        level_id: { type: string, nullable: true, example: "2" }
        level_name: { type: string, nullable: true, example: JLPT N2 }
        language_id: { type: string, nullable: true, example: KR }
        language_name: { type: string, nullable: true, example: 한국어 }
        is_special: { type: boolean, example: false }
        event_status:
          type: string
          description: 수업 이벤트 유형 (course_event.event_type)
          enum: [CANCEL, MAKEUP]
          example: CANCEL
        event_date: { type: string, format: date, nullable: true, example: 2025-04-15 }

    User:
      type: object
      properties:
        user_id:
          type: integer
          description: 사용자 고유 ID
          example: 1
        role_type:
          type: string
          enum: [student, professor, admin]
        status:
          type: string
          description: 현재 승인 상태
          example: "active"
    NoticeSummary:
      type: object
      properties:
        notice_id:
          type: integer
          example: 38
        title:
          type: string
          example: "새로운 공지"
        content:
          type: string
          example: "과제 마감일은 다음주 월요일입니다."
        is_pinned:
          type: boolean
          example: "true"
        created_at:
          type: string
          format: date-time
          example: "2025-09-15T10:30:00Z"
        course_id:
          type: string
          example: "JAPAN G1"
        course_title:
          type: string
          example: "기초 일본어"
        course_type:
          type: string
          example: "general"
        attach_count:
          type: integer
          example: 1
        author:
          type: array
          items:
            type: object
            properties:
              user_id:
                type: string
                example: "8888001"
              name:
                type: string
                example: "이교수"
              role:
                type: string
                example: "professor"
        targets:
          type: array
          items:
            type: object
            properties:
              grade_id:
                type: string
                example: "1"
              class_id:
                type: string
                example: "N1"
              language_id:
                type: string
                example: "JP"
        attachments:
          type: array
          items:
            type: object
            properties:
              file_id:
                type: string
                example: "FIbfa15e06"
              file_name:
                type: string
                example: "과제안내.hwpx"
              file_url:
                type: string
                example: "/files/FIbfa15e06/download"
              file_type:
                type: string
                example: "application/haansofthwp+xml"
        thumb_url:
          type: string
          example: "/files/5/download"
    NoticeDetail:
      allOf:
        - $ref: "#/components/schemas/NoticeSummary"
        - type: object
          properties:
            content: { type: string }
            attachments:
              type: array
              items:
                $ref: "#/components/schemas/Attachment"
    NoticeCreateRequest:
      type: object
      properties:
        title:
          type: string
          description: "공지사항 제목"
          example: "10월 주요 학사일정 안내"
        content:
          type: string
          description: "공지사항 본문 내용"
          example: "안녕하세요. 10월 주요 학사일정을 안내드립니다."
        is_pinned:
          type: boolean
          description: "중요 공지사항"
          example: "true"
        course_id:
          type: string
          description: "과목 공지일 경우 해당하는 과목 ID. 전체 공지일 경우 생략 가능."
          example: "COURSE-G1-01"
        specific_users:
          type: array
          items:
            type: integer
            example: 2423004
          description: |
            "공지 대상 학생을 지정하는 객체 배열. multipart/form-data 전송 시에는 이 배열을 JSON 문자열로 변환하여 보내야 합니다."
            - `application/json` 요청 시: `[2423004, 2423005]` 형태로 전송
            - `multipart/form-data` 요청 시: 문자열로 직렬화하여 `"["2423004","2423005"]"` 형태로 전송해야 합니다.
            - 비워둘 경우 전체 타겟(학년/레벨 기준)으로 발송됩니다.
          example: [2423004, 2423005, 2423006]

        targets:
          type: array
          description: "공지 대상을 지정하는 객체 배열. multipart/form-data 전송 시에는 이 배열을 JSON 문자열로 변환하여 보내야 합니다."
          items:
            type: object
            properties:
              target_grade_id:
                type: string
                example: "G1"
              target_level_id:
                type: string
                example: "N1"
              target_language_id:
                type: string
                example: "JP"
          # 배열 전체에 대한 example을 YAML 배열 형식으로 제공
          example:
            - target_grade_id: "G1"
              target_class_id: "N1"
              target_language_id: "JP"
            - target_grade_id: "G2"
              target_class_id: "N3"
              target_language_id: "EN"
        files:
          type: array
          items:
            type: string
            format: binary
          description: "첨부할 파일들"
    NoticeReadStatus:
      type: object
      properties:
        user_id: { type: integer }
        student_name: { type: string }
        status:
          type: string
          enum: [SENT, FAILED]
        read_at: { type: string, format: date-time, nullable: true }

    KakaoSendRequest:
      type: object
      description: 카카오 알림톡 발송을 위한 정보를 담는 객체
      required: [template_code, sender_key]
      properties:
        template_code:
          type: string
          description: 카카오 채널에 사전 승인된 템플릿의 고유 코드
          example: NOTICE_ASSIGNMENT_V2
        template_params:
          type: object
          description: "모든 수신자에게 공통으로 적용될 템플릿 변수들 (예: #{title})"
          example:
            title: 2주차 과제 안내
            content_preview: 첨부파일을 확인하여 과제를 제출하세요.
            link_url: https://portal.gsc/notices/124
        per_recipient:
          type: array
          items:
            type: object
            properties:
              user_id: { type: integer }
              vars: { type: object }
        options:
          type: object
          properties:
            allow_fallback_sms: { type: boolean, default: false }
            schedule_at: { type: string, format: date-time, nullable: true }
      example:
        template_code: NOTICE_ASSIGNMENT_V2
        sender_key: KA01-12345ABCDE
        default_vars:
          notice_title: 2주차 과제 안내
          content_preview: 첨부파일을 확인하여 과제를 제출하세요. 기한은 다음 주 월요일까지입니다.
          counselor_name: Alice 교수
          link_url: https://portal.gsc/notices/124

    KakaoEnqueueResponse:
      type: object
      properties:
        job_id: { type: string, example: KJOB_20250914_001 }
        accepted: { type: integer }
        rejected: { type: integer }
        reason: { type: string }

    ScheduleEntry:
      type: object
      properties:
        class_date: { type: string, format: date }
        day_of_week:
          type: string
          enum: [MON, TUE, WED, THU, FRI, SAT, SUN]
        start_time: { type: string, format: time }
        end_time: { type: string, format: time }
        classroom_name: { type: string }
        course_title: { type: string }
        is_special: { type: boolean }
        source:
          type: string
          enum: [PLANNED, MAKEUP]
          description: 정규 수업인지 보강 수업인지 여부

    Reservation:
      type: object
      properties:
        reservation_id: { type: integer }
        reserved_by: { type: string }
        classroom_id: { type: string }
        building: { type: string }
        room_number: { type: string }
        reservation_title: { type: string }
        start_at: { type: string, format: date-time }
        end_at: { type: string, format: date-time }
        status:
          type: string
          enum: [ACTIVE, CANCELLED, FINISHED]

    ReservationRequest:
      type: object
      properties:
        classroom_id: { type: string }
        title: { type: string }
        start_at: { type: string, format: date-time }
        end_at: { type: string, format: date-time }

    WeekendPollStatus:
      type: object
      properties:
        poll_id:
          type: string
          example: POLL_CM405_20250920
        poll_date:
          type: string
          format: date
          example: "2025-09-20"
        classroom_name:
          type: string
          example: 청문관-405
        required_count:
          type: integer
          example: 5
        is_opened:
          type: boolean
          example: false
        yes_votes:
          type: integer
          example: 3
      example:
        poll_id: POLL_CM405_20250920
        poll_date: "2025-09-20"
        classroom_name: 청문관-405
        required_count: 5
        is_opened: false
        yes_votes: 3

    AuthResponse:
      type: object
      properties:
        success:
          type: boolean
          example: true
        message:
          type: string
          example: "Access Token이 성공적으로 발급"
        user:
          $ref: "#/components/schemas/User"
    ErrorResponse:
      type: object
      properties:
        message:
          type: string
          example: Error message details.

    DashboardSchedule:
      type: object
      properties:
        course_title:
          type: string
          example: 기초 공학
        classroom_name:
          type: string
          example: 청문관-405
        start_time:
          type: string
          format: time
          example: "10:00:00"
        end_time:
          type: string
          format: time
          example: "11:50:00"
    DashboardCleaning:
      type: object
      properties:
        grade_id: { type: string, example: G1 }
        classroom_name: { type: string, example: 청문관-405 }
        members:
          type: array
          items: { type: string }
          example: [G1 Student 01, G1 Student 02]

    DashboardResponse:
      type: object
      properties:
        schedule:
          type: array
          items:
            $ref: "#/components/schemas/TimetableWeeklyResponse"
        huka_schedule:
          type: array
          items:
            type: object
            properties:
              MON:
                type: object
                example:
                  "8": { "student": "국내1-JP-A", "location": "실습동301호" }
                  "9": { "student": "2423004", "location": "본관201호" }
        notices:
          type: array
          items:
            $ref: "#/components/schemas/NoticeSummary"
        cleaning_duty:
          type: array
          items:
            $ref: "#/components/schemas/CleaningRosterResponse"
        weekend_poll:
          type: array
          items:
            $ref: '#/components/schemas/WeekendPollItem'
            example:
              - poll_id: "P001"
                grade_name: "1학년"
                poll_date: "2025-10-17"
                day_of_week: "토요일"
                required_count: 8
                vote_count: 4
                is_opened: false
                user_voted: true
              - poll_id: "P002"
                grade_name: "2학년"
                poll_date: "2025-10-18"
                day_of_week: "일요일"
                required_count: 10
                vote_count: 0
                is_opened: false
                user_voted: false

    UserRegistrationRequest:
      type: object
      description: 최초 로그인 사용자가 가입을 위해 제출하는 추가 정보
      required:
        - name
        - user_id
        - phone
        - email
        - is_student
        - grade_id
        - class_id
        - language_id
      properties:
        name:
          type: string
          description: 사용자 본명
          example: 김민준
        user_id:
          type: string
          description: "학번"
          example: "2423001"
        phone:
          type: string
          description: 연락 가능한 전화번호
          example: 010-1234-5678
        email:
          type: string
          description: 이메일 주소
          example: minjun.kim@g.yju.ac.kr
        is_student:
          type: boolean
          description: "학생이면 true, 교수면 false"
          example: true
        grade_id:
          type: string
          description: 소속 학년(Grade) ID
          example: null
        class_id:
          type: string
          description: 소속 반(Class) ID
          example: null
        language_id:
          type: string
          description: 언어 ID
          example: null
        is_international:
          type: boolean
          description: 유학생 여부
          example: null
    StudentApproval:
      type: object
      description: 학생 승인 대기 목록에 표시될 정보 (v_student_approval 뷰 기반)
      properties:
        user_id: { type: integer }
        name: { type: string }
        email: { type: string }
        phone: { type: string }
        grade_name: { type: string }
        class_name: { type: string }
        level_name: { type: string }
        language_name: { type: string }
        is_international: { type: string, example: 한국인 }
        status: { type: string, example: pending }

    ProfessorApproval:
      type: object
      description: 교수 승인 대기 목록에 표시될 정보 (v_professor_approval 뷰 기반)
      properties:
        user_id: { type: integer }
        name: { type: string }
        email: { type: string }
        phone: { type: string }
        status: { type: string, example: pending }

    UpdateUserStatusRequest:
      type: object
      description: 사용자 상태를 변경할 때 보내는 요청 본문
      properties:
        status:
          type: string
          enum: [active, inactive]
          description: 승인 시 'active', 거절 시 'inactive'로 변경
          example: active

    GenerateRosterRequest:
      type: object
      properties:
        grade_id:
          type: string
          example: G1
        section_start_date:
          type: string
          format: date
          example: "2025-09-01"
        section_end_date:
          type: string
          format: date
          example: "2025-12-20"
        team_size:
          type: integer
          example: 5
        classroom_id:
          type: string
          example: CM405
    Attachment:
      type: object
      properties:
        file_id:
          type: string
        file_name:
          type: string
        file_url:
          type: string
          format: uri
        file_type:
          type: string
    NoticeUpdateRequest:
      type: object
      description: 공지사항 수정을 위한 요청 본문 (보낸 필드만 변경)
      properties:
        title:
          type: string
          description: "새로운 공지 제목 (변경하지 않으면 보내지 않음)"
        content:
          type: string
          description: "새로운 공지 본문 (변경하지 않으면 보내지 않음)"
        course_id:
          type: string
          nullable: true
          description: "과목 ID (null로 보내면 과목 연결 해제)"
        targets:
          type: array
          description: "공지 대상을 지정하는 객체 배열. multipart/form-data 전송 시에는 이 배열을 JSON 문자열로 변환하여 보내야 합니다."
          items:
            type: object
            properties:
              target_grade_id:
                type: string
                example: "G1"
              target_level_id:
                type: string
                example: "N1"
              target_language_id:
                type: string
                example: "JP"
          # 배열 전체에 대한 example을 YAML 배열 형식으로 제공
          example:
            - target_grade_id: "G1"
              target_level_id: "N1"
              target_language_id: "JP"
            - target_grade_id: "G2"
              target_level_id: "N3"
              target_language_id: "EN"
        new_files:
          type: array
          description: "새롭게 추가할 첨부 파일들"
          items:
            type: string
            format: binary
        remove_file_ids:
          type: array
          description: "삭제할 기존 첨부 파일들의 ID 목록. JSON 문자열 형태로 전송해야 합니다."
          items:
            type: string
          example: '["F000000001", "F000000002"]'
    DirectMessageRequest:
      type: object
      required: [target_user_ids, message]
      properties:
        target_user_ids:
          type: array
          description: 메시지를 수신할 사용자 ID 목록
          items: { type: integer }
          example: [2423005, 2423012, 2523023]
        message:
          description: 발송할 메시지 내용
          $ref: "#/components/schemas/KakaoSendRequest"
    CleaningRoster:
      type: object
      properties:
        work_date:
          type: string
          format: date
          description: 해당 주가 시작하는 월요일 날짜
        classroom_name: { type: string, example: 청문관-405 }
        members:
          type: array
          items: { type: string }
          example: [아카자, 하쿠지, 기유, 코유키, 탄지로]

    GradeCleaningRoster:
      type: object
      properties:
        grade_id: { type: string, example: G1 }
        classroom_name: { type: string, example: 청문관-405 }
        weekly_duties:
          type: array
          items:
            $ref: "#/components/schemas/CleaningRoster"
      example:
        section: 2025-2
        rosters:
          - grade_id: G1
            classroom_name: 창조관-304
            weekly_duties:
              - work_date: "2025-09-15"
                members:
                  - G1 Student 01
                  - G1 Student 02
              - work_date: "2025-09-22"
                members:
                  - G1 Student 03
                  - G1 Student 04
          - grade_id: G2
            classroom_name: 창조관-405
            weekly_duties:
              - work_date: "2025-09-15"
                members:
                  - G2 Student 01
                  - G2 Student 02
